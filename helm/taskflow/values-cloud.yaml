# TaskFlow Platform - Cloud Production Values
# Used by GitHub Actions CD pipeline for cloud deployments
#
# Secrets are injected via --set flags from GitHub Secrets
# This file contains non-sensitive cloud-specific configuration

global:
  # Domain is set via vars.DOMAIN in GitHub
  domain: ""
  namespace: taskflow
  imagePullPolicy: Always
  # Image registry and tag set via --set in workflow
  # imageRegistry: ghcr.io/owner/taskflow
  # imageTag: abc123

# =============================================================================
# MANAGED SERVICES (Neon + Upstash)
# Values injected from GitHub Secrets
# =============================================================================
managedServices:
  neon:
    enabled: true
    # Connection strings injected via --set from secrets
  upstash:
    enabled: true
    # Credentials injected via --set from secrets

# Disable in-cluster databases (using Neon)
pgadmin:
  enabled: false

# =============================================================================
# SSO Platform
# =============================================================================
sso:
  enabled: true
  name: sso-platform
  replicaCount: 1

  image:
    # Repository will be: ${global.imageRegistry}/sso-platform
    repository: sso-platform
    pullPolicy: Always

  # Disable migrations - run locally for Neon
  migrations:
    enabled: false

  service:
    type: ClusterIP
    port: 3001
    targetPort: 3001

  ingress:
    enabled: true
    className: nginx
    host: ""  # Will be sso.${domain}
    tls:
      enabled: true
      secretName: sso-tls

  # Disable in-cluster postgres (using Neon)
  postgresql:
    enabled: false

  env:
    NODE_ENV: production
    # BETTER_AUTH_URL will be https://sso.${domain}
    # ALLOWED_ORIGINS will be https://${domain},https://sso.${domain}

  smtp:
    enabled: true
    host: smtp.gmail.com
    port: "587"
    user: mr.junaid.ca@gmail.com
    secure: "false"
    emailFrom: no-reply@taskflow.org

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# =============================================================================
# API Service
# =============================================================================
api:
  enabled: true
  name: taskflow-api
  daprAppId: taskflow-api
  replicaCount: 1

  image:
    repository: api
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000

  ingress:
    enabled: true
    className: nginx
    host: ""  # Will be api.${domain}
    tls:
      enabled: true
      secretName: api-tls

  # Disable in-cluster postgres (using Neon)
  postgresql:
    enabled: false

  env:
    ENV: production
    SSO_URL: http://sso-platform:3001
    # CORS_ORIGINS set via template

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# =============================================================================
# MCP Server
# =============================================================================
mcpServer:
  enabled: true
  name: mcp-server
  replicaCount: 1

  image:
    repository: mcp-server
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 8001
    targetPort: 8001

  env:
    ENV: production
    SSO_URL: http://sso-platform:3001
    TASKFLOW_API_URL: http://taskflow-api:8000

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# =============================================================================
# Web Dashboard
# =============================================================================
web:
  enabled: true
  name: web-dashboard
  replicaCount: 1

  image:
    repository: web-dashboard
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 3000
    targetPort: 3000

  ingress:
    enabled: true
    className: nginx
    host: ""  # Will be ${domain}
    tls:
      enabled: true
      secretName: web-tls

  env:
    NODE_ENV: production
    # URLs set at build time or via template
    # NEXT_PUBLIC_API_URL: https://api.${domain}
    # NEXT_PUBLIC_SSO_URL: https://sso.${domain}

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# =============================================================================
# Notification Service
# =============================================================================
notificationService:
  enabled: true
  name: taskflow-notification
  daprAppId: notification-service
  replicas: 1
  port: 8001
  logLevel: INFO

  image:
    repository: notification-service
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 8001

  # Disable in-cluster postgres (using Neon)
  postgresql:
    enabled: false

  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "250m"

# =============================================================================
# Dapr Configuration (using Upstash Redis)
# =============================================================================
dapr:
  enabled: true

  pubsub:
    name: taskflow-pubsub
    type: pubsub.redis
    # redisHost and redisPassword injected from Upstash secrets
    enableTLS: "true"  # Upstash requires TLS

  scheduler:
    enabled: true
    name: taskflow-scheduler

# =============================================================================
# Ingress Controller
# =============================================================================
ingress-nginx:
  enabled: true
  controller:
    service:
      type: LoadBalancer  # Cloud provider will assign external IP
    config:
      proxy-body-size: "50m"
      ssl-protocols: "TLSv1.2 TLSv1.3"

# =============================================================================
# Cert-Manager (for automatic TLS certificates)
# =============================================================================
# Note: Cert-manager should be installed separately in the cluster
# kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml
